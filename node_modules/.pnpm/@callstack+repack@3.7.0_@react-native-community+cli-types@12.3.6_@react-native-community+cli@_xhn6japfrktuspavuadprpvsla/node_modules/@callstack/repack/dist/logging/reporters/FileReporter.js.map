{"version":3,"file":"FileReporter.js","names":["FileReporter","buffer","constructor","config","path","isAbsolute","filename","join","process","cwd","fs","mkdirSync","dirname","recursive","throttledFlush","throttle","flush","log","push","JSON","stringify","length","writeFileSync","flag","stop"],"sources":["../../../src/logging/reporters/FileReporter.ts"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport throttle from 'lodash.throttle';\nimport type { LogEntry, Reporter } from '../types';\n\nexport interface FileReporterConfig {\n  filename: string;\n}\n\nexport class FileReporter implements Reporter {\n  private buffer: string[] = ['\\n\\n--- BEGINNING OF NEW LOG ---\\n'];\n\n  constructor(private config: FileReporterConfig) {\n    if (!path.isAbsolute(this.config.filename)) {\n      this.config.filename = path.join(process.cwd(), this.config.filename);\n    }\n\n    fs.mkdirSync(path.dirname(this.config.filename), { recursive: true });\n  }\n\n  throttledFlush = throttle(() => {\n    this.flush();\n  }, 1000);\n\n  process(log: LogEntry) {\n    this.buffer.push(JSON.stringify(log));\n    this.throttledFlush();\n  }\n\n  flush() {\n    if (!this.buffer.length) {\n      return;\n    }\n\n    fs.writeFileSync(this.config.filename, this.buffer.join('\\n'), {\n      flag: 'a',\n    });\n    this.buffer = [];\n  }\n\n  stop() {\n    this.flush();\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;AAOO,MAAMA,YAAN,CAAuC;EACpCC,MAAM,GAAa,CAAC,oCAAD,CAAb;;EAEdC,WAAW,CAASC,MAAT,EAAqC;IAAA,KAA5BA,MAA4B,GAA5BA,MAA4B;;IAC9C,IAAI,CAACC,aAAA,CAAKC,UAAL,CAAgB,KAAKF,MAAL,CAAYG,QAA5B,CAAL,EAA4C;MAC1C,KAAKH,MAAL,CAAYG,QAAZ,GAAuBF,aAAA,CAAKG,IAAL,CAAUC,OAAO,CAACC,GAAR,EAAV,EAAyB,KAAKN,MAAL,CAAYG,QAArC,CAAvB;IACD;;IAEDI,WAAA,CAAGC,SAAH,CAAaP,aAAA,CAAKQ,OAAL,CAAa,KAAKT,MAAL,CAAYG,QAAzB,CAAb,EAAiD;MAAEO,SAAS,EAAE;IAAb,CAAjD;EACD;;EAEDC,cAAc,GAAG,IAAAC,eAAA,EAAS,MAAM;IAC9B,KAAKC,KAAL;EACD,CAFgB,EAEd,IAFc,CAAH;;EAIdR,OAAO,CAACS,GAAD,EAAgB;IACrB,KAAKhB,MAAL,CAAYiB,IAAZ,CAAiBC,IAAI,CAACC,SAAL,CAAeH,GAAf,CAAjB;IACA,KAAKH,cAAL;EACD;;EAEDE,KAAK,GAAG;IACN,IAAI,CAAC,KAAKf,MAAL,CAAYoB,MAAjB,EAAyB;MACvB;IACD;;IAEDX,WAAA,CAAGY,aAAH,CAAiB,KAAKnB,MAAL,CAAYG,QAA7B,EAAuC,KAAKL,MAAL,CAAYM,IAAZ,CAAiB,IAAjB,CAAvC,EAA+D;MAC7DgB,IAAI,EAAE;IADuD,CAA/D;;IAGA,KAAKtB,MAAL,GAAc,EAAd;EACD;;EAEDuB,IAAI,GAAG;IACL,KAAKR,KAAL;EACD;;AAjC2C"}