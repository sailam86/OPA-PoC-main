{"version":3,"file":"extractAssets.js","names":["extractAssets","resourcePath","resourceDirname","resourceFilename","resourceExtensionType","assets","suffixPattern","assetsDirname","pathSeparatorRegexp","publicPath","customPublicPath","devServerEnabled","logger","path","join","replace","hashes","Promise","all","map","asset","hasha","async","content","toString","filename","algorithm","size","getImageSize","debug","height","width","dedent","JSON","stringify","scale"],"sources":["../../../../src/webpack/loaders/assetsLoader/extractAssets.ts"],"sourcesContent":["import path from 'path';\nimport dedent from 'dedent';\nimport hasha from 'hasha';\nimport type { WebpackLogger } from '../../../types';\nimport type { Asset } from './types';\nimport { getImageSize } from './utils';\n\nexport async function extractAssets(\n  {\n    resourcePath,\n    resourceDirname,\n    resourceFilename,\n    resourceExtensionType,\n    assets,\n    suffixPattern,\n    assetsDirname,\n    pathSeparatorRegexp,\n    publicPath: customPublicPath,\n    devServerEnabled,\n  }: {\n    resourcePath: string;\n    resourceDirname: string;\n    resourceFilename: string;\n    resourceExtensionType: string;\n    assets: Asset[];\n    suffixPattern: string;\n    assetsDirname: string;\n    pathSeparatorRegexp: RegExp;\n    publicPath?: string;\n    devServerEnabled?: boolean;\n  },\n  logger: WebpackLogger\n) {\n  let publicPath = path\n    .join(assetsDirname, resourceDirname)\n    .replace(pathSeparatorRegexp, '/');\n\n  if (customPublicPath) {\n    publicPath = path.join(customPublicPath, publicPath);\n  }\n\n  const hashes = await Promise.all(\n    assets.map((asset) =>\n      hasha.async(asset.content?.toString() ?? asset.filename, {\n        algorithm: 'md5',\n      })\n    )\n  );\n\n  const size = getImageSize({\n    resourceFilename,\n    resourcePath,\n    suffixPattern,\n  });\n\n  logger.debug(`Extracted assets for request ${resourcePath}`, {\n    hashes,\n    publicPath: customPublicPath,\n    height: size?.height,\n    width: size?.width,\n  });\n\n  return dedent`\n    var AssetRegistry = require('react-native/Libraries/Image/AssetRegistry');\n    module.exports = AssetRegistry.registerAsset({\n      __packager_asset: true,\n      scales: ${JSON.stringify(assets.map((asset) => asset.scale))},\n      name: ${JSON.stringify(resourceFilename)},\n      type: ${JSON.stringify(resourceExtensionType)},\n      hash: ${JSON.stringify(hashes.join())},\n      httpServerLocation: ${JSON.stringify(publicPath)},\n      ${\n        devServerEnabled\n          ? `fileSystemLocation: ${JSON.stringify(resourceDirname)},`\n          : ''\n      }\n      ${size ? `height: ${size.height},` : ''}\n      ${size ? `width: ${size.width},` : ''}\n    });\n    `;\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAGA;;;;AAEO,eAAeA,aAAf,CACL;EACEC,YADF;EAEEC,eAFF;EAGEC,gBAHF;EAIEC,qBAJF;EAKEC,MALF;EAMEC,aANF;EAOEC,aAPF;EAQEC,mBARF;EASEC,UAAU,EAAEC,gBATd;EAUEC;AAVF,CADK,EAwBLC,MAxBK,EAyBL;EACA,IAAIH,UAAU,GAAGI,aAAA,CACdC,IADc,CACTP,aADS,EACML,eADN,EAEda,OAFc,CAENP,mBAFM,EAEe,GAFf,CAAjB;;EAIA,IAAIE,gBAAJ,EAAsB;IACpBD,UAAU,GAAGI,aAAA,CAAKC,IAAL,CAAUJ,gBAAV,EAA4BD,UAA5B,CAAb;EACD;;EAED,MAAMO,MAAM,GAAG,MAAMC,OAAO,CAACC,GAAR,CACnBb,MAAM,CAACc,GAAP,CAAYC,KAAD;IAAA;;IAAA,OACTC,cAAA,CAAMC,KAAN,CAAY,mBAAAF,KAAK,CAACG,OAAN,kEAAeC,QAAf,OAA6BJ,KAAK,CAACK,QAA/C,EAAyD;MACvDC,SAAS,EAAE;IAD4C,CAAzD,CADS;EAAA,CAAX,CADmB,CAArB;EAQA,MAAMC,IAAI,GAAG,IAAAC,mBAAA,EAAa;IACxBzB,gBADwB;IAExBF,YAFwB;IAGxBK;EAHwB,CAAb,CAAb;EAMAM,MAAM,CAACiB,KAAP,CAAc,gCAA+B5B,YAAa,EAA1D,EAA6D;IAC3De,MAD2D;IAE3DP,UAAU,EAAEC,gBAF+C;IAG3DoB,MAAM,EAAEH,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEG,MAH6C;IAI3DC,KAAK,EAAEJ,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEI;EAJ8C,CAA7D;EAOA,OAAO,IAAAC,eAAA,CAAO;AAChB;AACA;AACA;AACA,gBAAgBC,IAAI,CAACC,SAAL,CAAe7B,MAAM,CAACc,GAAP,CAAYC,KAAD,IAAWA,KAAK,CAACe,KAA5B,CAAf,CAAmD;AACnE,cAAcF,IAAI,CAACC,SAAL,CAAe/B,gBAAf,CAAiC;AAC/C,cAAc8B,IAAI,CAACC,SAAL,CAAe9B,qBAAf,CAAsC;AACpD,cAAc6B,IAAI,CAACC,SAAL,CAAelB,MAAM,CAACF,IAAP,EAAf,CAA8B;AAC5C,4BAA4BmB,IAAI,CAACC,SAAL,CAAezB,UAAf,CAA2B;AACvD,QACQE,gBAAgB,GACX,uBAAsBsB,IAAI,CAACC,SAAL,CAAehC,eAAf,CAAgC,GAD3C,GAEZ,EACL;AACP,QAAQyB,IAAI,GAAI,WAAUA,IAAI,CAACG,MAAO,GAA1B,GAA+B,EAAG;AAC9C,QAAQH,IAAI,GAAI,UAASA,IAAI,CAACI,KAAM,GAAxB,GAA6B,EAAG;AAC5C;AACA,KAjBE;AAkBD"}