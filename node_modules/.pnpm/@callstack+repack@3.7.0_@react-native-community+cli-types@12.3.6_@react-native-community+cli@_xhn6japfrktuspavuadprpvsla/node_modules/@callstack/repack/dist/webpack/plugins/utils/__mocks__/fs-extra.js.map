{"version":3,"file":"fs-extra.js","names":["FsNode","constructor","path","makeDir","value","undefined","Error","children","makeFile","findDir","dirname","create","currentSegment","segments","split","sep","foundDir","child","join","push","FsMock","fs","ensureDir","copyFile","from","to","content","readFile","writeFile","filePath","basename","dirNode","found","file"],"sources":["../../../../../src/webpack/plugins/utils/__mocks__/fs-extra.ts"],"sourcesContent":["import path from 'path';\n\nclass FsNode {\n  value?: string;\n  children?: FsNode[];\n\n  constructor(public path: string) {}\n\n  makeDir() {\n    if (this.value !== undefined) {\n      throw new Error('Node is already a file');\n    }\n\n    if (!this.children) {\n      this.children = [];\n    }\n  }\n\n  makeFile(value: string) {\n    if (this.children) {\n      throw new Error('Node is already a directory');\n    }\n    this.value = value;\n  }\n\n  findDir(dirname: string, create = false): FsNode {\n    if (this.value !== undefined || this.children == undefined) {\n      throw new Error('not a directory');\n    }\n\n    const [currentSegment, ...segments] = dirname.split(path.sep);\n\n    if (currentSegment === '.') {\n      return this;\n    }\n\n    let foundDir: FsNode | undefined;\n    for (const child of this.children) {\n      if (child.children && child.path === currentSegment) {\n        foundDir = child.findDir(path.join(...segments), create);\n      }\n    }\n\n    if (!foundDir) {\n      if (create) {\n        const child = new FsNode(currentSegment);\n        child.makeDir();\n        this.children.push(child);\n        foundDir = child.findDir(path.join(...segments), create);\n      } else {\n        throw new Error(`directory does not exist: ${dirname}`);\n      }\n    }\n\n    return foundDir;\n  }\n}\n\nclass FsMock {\n  fs: FsNode;\n\n  constructor() {\n    this.fs = new FsNode('/');\n    this.fs.makeDir();\n  }\n\n  async ensureDir(dirname: string) {\n    const [, ...segments] = dirname.split(path.sep);\n    this.fs.findDir(path.join(...segments), true);\n  }\n\n  async copyFile(from: string, to: string) {\n    const content = await this.readFile(from);\n    await this.writeFile(to, content);\n  }\n\n  async readFile(filePath: string) {\n    const [, ...segments] = path.dirname(filePath).split(path.sep);\n    const dirname = path.join(...segments);\n    const basename = path.basename(filePath);\n\n    const dirNode = this.fs.findDir(dirname);\n    for (const child of dirNode.children ?? []) {\n      if (child.path === basename) {\n        if (child.value === undefined) {\n          throw new Error('not a file');\n        }\n\n        return child.value;\n      }\n    }\n\n    throw new Error(`no such file: ${filePath}`);\n  }\n\n  async writeFile(filePath: string, value: string) {\n    const [, ...segments] = path.dirname(filePath).split(path.sep);\n    const dirname = path.join(...segments);\n    const basename = path.basename(filePath);\n\n    const dirNode = this.fs.findDir(dirname);\n    let found = false;\n    for (const child of dirNode.children ?? []) {\n      if (child.path === basename) {\n        if (child.children !== undefined) {\n          throw new Error(`not a file: ${filePath}`);\n        }\n\n        child.value = value;\n        found = true;\n        break;\n      }\n    }\n\n    if (!found) {\n      const file = new FsNode(basename);\n      file.makeFile(value);\n      dirNode.children!.push(file);\n    }\n  }\n}\n\nexport default new FsMock();\n"],"mappings":"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"}