{"version":3,"file":"apiPlugin.js","names":["paramsSchema","type","properties","platform","required","apiPlugin","instance","delegate","get","_request","reply","api","send","data","getPlatforms","notImplemented","schema","params","request","getAssets","getCompilationStats"],"sources":["../../../src/plugins/api/apiPlugin.ts"],"sourcesContent":["import type { FastifyInstance } from 'fastify';\nimport type { Server } from '../../types';\n\nconst paramsSchema = {\n  type: 'object',\n  properties: {\n    platform: {\n      type: 'string',\n    },\n  },\n  required: ['platform'],\n};\n\ntype Params = { platform: string };\n\nasync function apiPlugin(\n  instance: FastifyInstance,\n  { delegate }: { delegate: Server.Delegate }\n) {\n  instance.get('/platforms', async (_request, reply) =>\n    delegate.api\n      ? reply.send({ data: await delegate.api.getPlatforms() })\n      : reply.notImplemented('Missing API delegate implementation')\n  );\n\n  instance.get<{ Params: Params }>(\n    '/:platform/assets',\n    { schema: { params: paramsSchema } },\n    async (request, reply) =>\n      delegate.api\n        ? reply.send({\n            data: await delegate.api.getAssets(request.params.platform),\n          })\n        : reply.notImplemented('Missing API delegate implementation')\n  );\n\n  instance.get<{ Params: Params }>(\n    '/:platform/stats',\n    { schema: { params: paramsSchema } },\n    async (request, reply) =>\n      delegate.api\n        ? reply.send({\n            data: await delegate.api?.getCompilationStats(\n              request.params.platform\n            ),\n          })\n        : reply.notImplemented('Missing API delegate implementation')\n  );\n}\n\nexport default apiPlugin;\n"],"mappings":"AAGA,MAAMA,YAAY,GAAG;EACnBC,IAAI,EAAE,QADa;EAEnBC,UAAU,EAAE;IACVC,QAAQ,EAAE;MACRF,IAAI,EAAE;IADE;EADA,CAFO;EAOnBG,QAAQ,EAAE,CAAC,UAAD;AAPS,CAArB;;AAYA,eAAeC,SAAf,CACEC,QADF,EAEE;EAAEC;AAAF,CAFF,EAGE;EACAD,QAAQ,CAACE,GAAT,CAAa,YAAb,EAA2B,OAAOC,QAAP,EAAiBC,KAAjB,KACzBH,QAAQ,CAACI,GAAT,GACID,KAAK,CAACE,IAAN,CAAW;IAAEC,IAAI,EAAE,MAAMN,QAAQ,CAACI,GAAT,CAAaG,YAAb;EAAd,CAAX,CADJ,GAEIJ,KAAK,CAACK,cAAN,CAAqB,qCAArB,CAHN;EAMAT,QAAQ,CAACE,GAAT,CACE,mBADF,EAEE;IAAEQ,MAAM,EAAE;MAAEC,MAAM,EAAEjB;IAAV;EAAV,CAFF,EAGE,OAAOkB,OAAP,EAAgBR,KAAhB,KACEH,QAAQ,CAACI,GAAT,GACID,KAAK,CAACE,IAAN,CAAW;IACTC,IAAI,EAAE,MAAMN,QAAQ,CAACI,GAAT,CAAaQ,SAAb,CAAuBD,OAAO,CAACD,MAAR,CAAed,QAAtC;EADH,CAAX,CADJ,GAIIO,KAAK,CAACK,cAAN,CAAqB,qCAArB,CARR;EAWAT,QAAQ,CAACE,GAAT,CACE,kBADF,EAEE;IAAEQ,MAAM,EAAE;MAAEC,MAAM,EAAEjB;IAAV;EAAV,CAFF,EAGE,OAAOkB,OAAP,EAAgBR,KAAhB;IAAA;;IAAA,OACEH,QAAQ,CAACI,GAAT,GACID,KAAK,CAACE,IAAN,CAAW;MACTC,IAAI,EAAE,wBAAMN,QAAQ,CAACI,GAAf,kDAAM,cAAcS,mBAAd,CACVF,OAAO,CAACD,MAAR,CAAed,QADL,CAAN;IADG,CAAX,CADJ,GAMIO,KAAK,CAACK,cAAN,CAAqB,qCAArB,CAPN;EAAA,CAHF;AAYD;;AAED,eAAeV,SAAf"}